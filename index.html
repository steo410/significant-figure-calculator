<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìœ íš¨ìˆ«ì ê³„ì‚°ê¸°</title>
<style>
body{font-family:Arial,sans-serif;padding:20px}
.container{display:flex;gap:20px}
.calc,.display{border:1px solid #ccc;padding:15px;width:380px}
.buttons{display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
button{padding:10px;font-size:14px}
button.disabled{visibility:hidden}
.equal{grid-column:span 3;font-size:18px}
.screen{font-size:18px;min-height:40px;border:1px solid #aaa;padding:5px;margin-bottom:10px}
.popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4)}
.popup-content{background:#fff;padding:20px;margin:120px auto;width:260px;text-align:center}
</style>
</head>

<body>
<h1>ìœ íš¨ìˆ«ì ê³„ì‚°ê¸°</h1>

<div class="container">
<div class="calc">
<div class="buttons">

<button onclick="clearAll()">C</button>
<button onclick="backspace()">â†</button>
<button onclick="move(-1)">â—€</button>
<button onclick="move(1)">â–¶</button>
<button onclick="input('(')">(</button>
<button onclick="input(')')">)</button>

<button onclick="inputFunc('sqrt')">âˆš</button>
<button onclick="openRootPopup()">â¿âˆš</button>
<button onclick="inputFunc('log')">log</button>
<button onclick="inputFunc('sin')">sin</button>
<button onclick="inputFunc('cos')">cos</button>
<button onclick="inputFunc('tan')">tan</button>

<button onclick="input('7')">7</button>
<button onclick="input('8')">8</button>
<button onclick="input('9')">9</button>
<button onclick="input('1/(')">1/x</button>
<button onclick="input('Ï€')">Ï€</button>
<button onclick="input('e')">e</button>

<button onclick="input('4')">4</button>
<button onclick="input('5')">5</button>
<button onclick="input('6')">6</button>
<button onclick="inputOp('/')">Ã·</button>
<button onclick="inputOp('*')">Ã—</button>
<button class="disabled"></button>

<button onclick="input('1')">1</button>
<button onclick="input('2')">2</button>
<button onclick="input('3')">3</button>
<button onclick="inputOp('+')">+</button>
<button onclick="inputOp('-')">âˆ’</button>
<button class="disabled"></button>

<button onclick="input('^')">^</button>
<button onclick="input('0')">0</button>
<button onclick="input('.')">.</button>
<button onclick="calculate()" class="equal">=</button>

</div>
</div>

<div class="display">
<div class="screen" id="expr"></div>
<div class="screen" id="result"></div>
<div class="screen" style="font-size:14px;line-height:1.5">
<b>ìœ íš¨ìˆ«ì ê³„ì‚° ê·œì¹™</b><br>
â€¢ ë§ì…ˆÂ·ëº„ì…ˆ: ì†Œìˆ˜ì  ìë¦¬ ê¸°ì¤€(ì‘ì€ ê²ƒ)<br>
â€¢ ê³±ì…ˆÂ·ë‚˜ëˆ—ì…ˆ: ìœ íš¨ìˆ«ì ê°œìˆ˜ ê¸°ì¤€(ì‘ì€ ê²ƒ)<br>
â€¢ Ï€, e ë“± ì •ì˜ëœ ìˆ˜ëŠ” ìœ íš¨ìˆ«ìì— ì˜í–¥ ì—†ìŒ<br>
â€¢ ë°˜ì˜¬ë¦¼ì€ ê³„ì‚° ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ
</div>
</div>
</div>

<div class="popup" id="rootPopup">
<div class="popup-content">
<p>n ê°’ (ì •ìˆ˜)</p>
<input type="number" id="rootN" min="2" value="2">
<br><br>
<button onclick="confirmRoot()">í™•ì¸</button>
<button onclick="closeRootPopup()">ì·¨ì†Œ</button>
</div>
</div>

<script>
let expr='',cursor=0;

/* ìœ„ì²¨ì */
const sup={'0':'â°','1':'Â¹','2':'Â²','3':'Â³','4':'â´','5':'âµ','6':'â¶','7':'â·','8':'â¸','9':'â¹'};
const rev=Object.fromEntries(Object.entries(sup).map(([k,v])=>[v,k]));
const toSup=n=>String(n).split('').map(d=>sup[d]).join('');
const fromSup=s=>s.split('').map(c=>rev[c]).join('');

function render(){document.getElementById('expr').innerText=expr}
function input(v){expr+=v;render()}
function inputOp(o){expr+=` ${o} `}
function inputFunc(f){f==='sqrt'?input('âˆš('):input(f+'(')}
function move(){}
function backspace(){expr=expr.slice(0,-1);render()}
function clearAll(){expr='';render();result.innerText=''}
function openRootPopup(){rootPopup.style.display='block'}
function closeRootPopup(){rootPopup.style.display='none'}
function confirmRoot(){input(`${toSup(rootN.value)}âˆš(`);closeRootPopup()}

/* ë§ì…ˆÂ·ëº„ì…ˆ */
function sciAddSub(v, dec){
 if(v===0) return '0.0Ã—10^0';
 const e=Math.floor(Math.log10(Math.abs(v)));
 let m=v/10**e;
 m=Math.round((m+Number.EPSILON)*10**dec)/10**dec;
 return m.toFixed(dec)+'Ã—10^'+e;
}

/* ê³±ì…ˆÂ·ë‚˜ëˆ—ì…ˆ */
function sciMulDiv(v, sig){
 if(v===0) return '0.0Ã—10^0';
 const e=Math.floor(Math.log10(Math.abs(v)));
 const m=(v/10**e).toPrecision(sig); // ğŸ”´ ë¬¸ìì—´ ìœ ì§€
 return m+'Ã—10^'+e;
}

function calculate(){
 try{
  const nums=(expr.match(/\d+\.?\d*/g)||[]);
  const decs=nums.map(n=>n.includes('.')?n.split('.')[1].length:0);
  const sigs=nums.map(n=>n.replace('.','').replace(/^0+/,'').length);

  const minDec=Math.min(...decs);
  const minSig=Math.min(...sigs);

  let safe=expr
   .replace(/([â°Â¹Â²Â³â´âµâ¶â·â¸â¹]+)âˆš\(([^)]+)\)/g,(_,n,x)=>`Math.pow(${x},1/${fromSup(n)})`)
   .replace(/âˆš\(/g,'Math.sqrt(')
   .replace(/sin\(/g,'Math.sin(')
   .replace(/cos\(/g,'Math.cos(')
   .replace(/tan\(/g,'Math.tan(')
   .replace(/log\(/g,'Math.log10(')
   .replace(/Ï€/g,'Math.PI')
   .replace(/e/g,'Math.E')
   .replace(/Ã—/g,'*').replace(/Ã·/g,'/')
   .replace(/\^/g,'**')
   .replace(/âˆ’/g,'-');

  const raw=Function(`return ${safe}`)();

  const out =
    expr.includes('+')||expr.includes('-')
      ? sciAddSub(raw,minDec)
      : sciMulDiv(raw,minSig);

  result.innerText='= '+out;
 }catch{
  result.innerText='ê³„ì‚° ì˜¤ë¥˜';
 }
}
</script>
</body>
</html>
